<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SMSDash</title>
  <script src="https://telegram.org/js/telegram-widget.js?22"
          data-telegram-login="Fake_WA_bot"
          data-size="large"
          data-onauth="onTelegramAuth"
          data-request-access="write"></script>
  <script>
    async function checkHealth() {
      try {
        const res = await fetch('/api/health');
        const data = await res.json();
        document.getElementById("health").innerText = 
          `Health: ${data.status} @ ${data.version}`;
      } catch (e) {
        document.getElementById("health").innerText = "Health: unreachable";
      }
    }

    function onTelegramAuth(user) {
      fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(user)
      })
      .then(r => r.json())
      .then(d => {
        if (d.ok) {
          document.getElementById("welcome").innerText =
            `Welcome, @${d.username || d.userId}`;
        } else {
          alert("Login failed!");
        }
      })
      .catch(console.error);
    }

    window.onload = checkHealth;
  </script>
</head>
<body>
  <h1 id="welcome">Welcome</h1>
  <p id="health">Checking...</p>
  <p><a href="#" onclick="checkHealth()">Ping /api/health</a></p>
  <p><button disabled>Buy Number (stub)</button></p>
</body>
</html>

